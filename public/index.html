<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>–†–µ–∞–ª-—Ç–∞–π–º –ü–∞—Ä—Å–µ—Ä (—á–µ—Ä–µ–∑ AllOrigins)</title>
  <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Chart.js (–∑–∞ –±–∞–∂–∞–Ω–Ω—è) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .progress-container {
      position: relative;
      overflow: hidden;
      border-radius: 0.5rem;
      background-color: #f3f4f6;
      height: 1.75rem;
    }
    .progress-bar {
      background: linear-gradient(90deg, #3b82f6, #06b6d4);
      transition: width 1s ease-in-out;
      height: 100%;
    }
    .progress-label {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.875rem;
      font-weight: bold;
      color: black;
      z-index: 10;
    }
    .passed {
      background-color: #d1fae5; /* –ø—ñ–¥—Å–≤—ñ—Ç–∫–∞ –¥–ª—è —Ç–æ–ø-15 */
    }
    .tag {
      display: inline-block;
      color: white;
      font-size: 0.75rem;
      font-weight: 600;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      margin-left: 0.5rem;
    }
    .tag.dem-sokyra {
      background-color: #ef4444; /* –ß–µ—Ä–≤–æ–Ω–∏–π */
    }
    .tag.yarova {
      background-color: #10b981; /* –ó–µ–ª–µ–Ω–∏–π */
    }
    .tag.stalkeryata {
      background-color: #3b82f6; /* –°–∏–Ω—ñ–π */
    }
    .chart-container {
      position: relative;
      height: 300px;
      width: 100%;
    }
    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 50;
      background: white;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border-radius: 0.5rem;
      width: 90%;
      max-width: 500px;
      padding: 1rem;
      display: none;
    }
    .popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 0.5rem;
      margin-bottom: 1rem;
    }
    .popup-body {
      max-height: 300px;
      overflow-y: auto;
    }
    .popup-close {
      cursor: pointer;
      color: #6b7280;
      font-size: 1.25rem;
    }
    .popup-close:hover {
      color: #000;
    }
    .history-icon {
      cursor: pointer;
      color: #3b82f6;
      font-size: 1.5rem;
      vertical-align: middle;
    }
    a.pdf-link {
      color: #2563eb;
      text-decoration: underline;
    }
    a.pdf-link:hover {
      color: #1e40af;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div class="container mx-auto py-8 px-4">
    <h1 class="text-4xl md:text-5xl font-bold text-center text-gray-800 mb-8">
      –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è
    </h1>
    <div class="text-center mb-6">
      <p id="updateInfo" class="text-base md:text-lg font-medium text-gray-600"></p>
      <p class="text-sm md:text-base text-gray-500">
        (–î–∞–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ AllOrigins –∑ 
        <a href="https://rgk.vote.mod.gov.ua/protocol.txt" target="_blank" class="underline text-blue-600">
          rgk.vote.mod.gov.ua/protocol.txt
        </a>)
      </p>
    </div>

    <!-- –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –ø–æ—à—É–∫—É —Ç–∞ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è -->
    <div class="mb-4 flex flex-wrap gap-4 items-center">
      <input
        type="text"
        id="searchInput"
        placeholder="–ü–æ—à—É–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞..."
        class="flex-grow px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-400 focus:outline-none"
      />
      <select
        id="tagFilter"
        class="px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-400 focus:outline-none"
      >
        <option value="">–í—Å—ñ –≥—Ä—É–ø–∏</option>
      </select>
      <button
        id="sortByVotes"
        class="px-4 py-2 bg-blue-500 text-white rounded-lg shadow-md hover:bg-blue-600"
      >
        –°–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–º
      </button>
      <button
        id="sortById"
        class="px-4 py-2 bg-blue-500 text-white rounded-lg shadow-md hover:bg-blue-600"
      >
        –°–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑–∞ ID
      </button>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ -->
    <div id="candidateGrid" class="overflow-x-auto">
      <table class="table-auto w-full bg-white rounded-lg shadow-lg text-sm md:text-base">
        <thead class="bg-gradient-to-r from-gray-800 to-gray-700 text-white">
          <tr>
            <th class="p-4 text-left">ID</th>
            <th class="p-4 text-left">–Ü–º'—è</th>
            <th class="p-4 text-left">–û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è</th>
            <th class="p-4 text-right">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≥–æ–ª–æ—Å—ñ–≤</th>
            <th class="p-4 text-right">PDF</th>
            <th class="p-4 text-right">–Ü—Å—Ç–æ—Ä—ñ—è</th>
          </tr>
        </thead>
        <tbody id="candidateTable" class="divide-y divide-gray-200"></tbody>
      </table>
    </div>

    <!-- –ü–æ–ø–∞–ø (—ñ—Å—Ç–æ—Ä—ñ—è –≥–æ–ª–æ—Å—É–≤–∞–Ω—å) -->
    <div id="historyPopup" class="popup">
      <div class="popup-header">
        <h2 class="text-lg font-semibold text-gray-800">–Ü—Å—Ç–æ—Ä—ñ—è –≥–æ–ª–æ—Å—É–≤–∞–Ω—å</h2>
        <span id="closePopup" class="popup-close">&times;</span>
      </div>
      <div class="popup-body">
        <ul id="historyList" class="list-disc pl-5 text-gray-700"></ul>
      </div>
    </div>
  </div>

  <script>
    // ---------------------------------------------------------
    // 1. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö (—á–µ—Ä–µ–∑ AllOrigins)
    // ---------------------------------------------------------
    const PROTOCOL_URL = "https://api.allorigins.win/raw?url="
      + encodeURIComponent("https://rgk.vote.mod.gov.ua/protocol.txt");

    // –°–ø–∏—Å–æ–∫ —É—Å—ñ—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤ –∑ —ó—Ö –º–µ—Ç–∞–¥–∞–Ω–∏–º–∏ (—ñ–º‚Äô—è, –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è, PDF)
    const CANDIDATES_LIST = {
      "1": { name: "–ù–∏—à–ø–æ—Ä–∫–∞ –û–ª–µ–Ω–∞ –Ü–≤–∞–Ω—ñ–≤–Ω–∞", ngo: "–ê–Ω—Ç–∏–∫–æ—Ä—É–ø—Ü—ñ–π–Ω–∞ —Å–æ–∫–∏—Ä–∞", pdf: "public/candidates/–ù–∏—à–ø–æ—Ä–∫–∞.pdf" },
      "2": { name: "–°–æ–ª–æ–≤–π–æ–≤ –ú–∏–∫–∏—Ç–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á", ngo: "–ê–Ω—Ç–∏–∫–æ—Ä—É–ø—Ü—ñ–π–Ω–∞ —Å–æ–∫–∏—Ä–∞", pdf: "public/candidates/–°–æ–ª–æ–≤–π–æ–≤.pdf" },
      "3": { name: "–®—É–±–∞ –ê–Ω–∞—Å—Ç–∞—Å—ñ—è –í–∞–¥–∏–º—ñ–≤–Ω–∞", ngo: "–ê–Ω—Ç–∏–∫–æ—Ä—É–ø—Ü—ñ–π–Ω–∞ —Å–æ–∫–∏—Ä–∞", pdf: "public/candidates/–®—É–±–∞.pdf" },
      "4": { name: "–†–æ–º–∞–Ω—á—É–∫ –ê–Ω–¥—Ä—ñ–π –ë–æ–≥–¥–∞–Ω–æ–≤–∏—á", ngo: "–ê—Å–æ—Ü—ñ–∞—Ü—ñ—è –ø—Ä–∞–≤–Ω–∏–∫—ñ–≤ –£–∫—Ä–∞—ó–Ω–∏", pdf: "public/candidates/–†–æ–º–∞–Ω—á—É–∫.pdf" },
      "5": { name: "–ë—Ä—ñ—Ç –û—Ä–µ—Å—Ç–∞ –ü–∞–≤–ª—ñ–≤–Ω–∞", ngo: "–ë–û–ù", pdf: "public/candidates/–ë—Ä—ñ—Ç.pdf" },
      "6": { name: "–†—É—Å–∞–∫–æ–≤ –°–µ—Ä–≥—ñ–π –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á", ngo: "–ë—é—Ä–æ –ø—Ä–æ—Ç–∏–¥—ñ—ó –∫–æ—Ä—É–ø—Ü—ñ—ó", pdf: "public/candidates/–†—É—Å–∞–∫–æ–≤.pdf" },
      "7": { name: "–ì—É–¥–∏–º–µ–Ω–∫–æ –Æ—Ä—ñ–π –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á", ngo: "–í–µ—Ç–µ—Ä–∞–Ω—Å—å–∫–∞ —Å–æ–∫–∏—Ä–∞", pdf: "public/candidates/–ì—É–¥–∏–º–µ–Ω–∫–æ.pdf" },
      "8": { name: "–®—Ç–∞–Ω–∫–æ–≤ –ú–∏–∫–∏—Ç–∞ –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á", ngo: "–í–µ—Ç–µ—Ä–∞–Ω—Å—å–∫–∞ —Å–æ–∫–∏—Ä–∞", pdf: "public/candidates/–®—Ç–∞–Ω–∫–æ–≤.pdf" },
      "9": { name: "–ê–∫–æ–ø—è–Ω –†—É–¥–æ–ª—å—Ñ –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á", ngo: "–í—Å–µ—É–∫—Ä–∞—ó–Ω—Å—å–∫–µ –±—é—Ä–æ –ª—é—Å—Ç—Ä–∞—Ü—ñ—ó —Ç–∞ –ø—Ä–æ—Ç–∏–¥—ñ—ó –∫–æ—Ä—É–ø—Ü—ñ—ó / –ë—é—Ä–æ –ø—Ä–æ—Ç–∏–¥—ñ—ó –∫–æ—Ä—É–ø—Ü—ñ—ó", pdf: "public/candidates/–ê–∫–æ–ø—è–Ω.pdf" },
      "10": { name: "–ì—Ä–∏—à–∫–æ –í–µ—Ä–æ–Ω—ñ–∫–∞ –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞", ngo: "–î–µ—Ç–µ–∫—Ç–æ—Ä –≤–ª–∞–¥–∏", pdf: "public/candidates/–ì—Ä–∏—à–∫–æ.pdf" },
      "11": { name: "–Æ—Ä—á–µ–Ω–∫–æ –ê–Ω–Ω–∞ –Ü–≥–æ—Ä—ñ–≤–Ω–∞", ngo: "–î–µ—Ç–µ–∫—Ç–æ—Ä –≤–ª–∞–¥–∏", pdf: "public/candidates/–Æ—Ä—á–µ–Ω–∫–æ.pdf" },
      "12": { name: "–ú–µ–ª—å–Ω–∏–∫ –†—É—Å–ª–∞–Ω –î–º–∏—Ç—Ä–æ–≤–∏—á", ngo: "–ó–∞—Ö–∏—Å—Ç-–Ñ", pdf: "public/candidates/–ú–µ–ª—å–Ω–∏–∫.pdf" },
      "13": { name: "–û–ª—ñ–≤—ñ–Ω—Å—å–∫–∏–π –û–ª–µ–∫—Å–∞–Ω–¥—Ä –í—ñ–∫—Ç–æ—Ä–æ–≤–∏—á", ngo: "–ö–∏—ó–≤—Å—å–∫–∞ —Å–ø—ñ–ª–∫–∞ –≤–µ—Ç–µ—Ä–∞–Ω—ñ–≤ –≤—ñ–π–Ω–∏ –∑ –†–æ—Å—ñ—î—é", pdf: "public/candidates/–û–ª—ñ–≤—ñ–Ω—Å—å–∫–∏–π.pdf" },
      "14": { name: "–°–≤–∏–Ω–∞—Ä–µ–Ω–∫–æ –û–ª–µ–∫—Å—ñ–π –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á", ngo: "–ö–∏—ó–≤—Å—å–∫–∞ —Å–ø—ñ–ª–∫–∞ –≤–µ—Ç–µ—Ä–∞–Ω—ñ–≤ –≤—ñ–π–Ω–∏ –∑ –†–æ—Å—ñ—î—é", pdf: "public/candidates/–°–≤–∏–Ω–∞—Ä–µ–Ω–∫–æ.pdf" },
      "15": { name: "–ö—É—Ç–Ω–∏–π –†–æ–º–∞–Ω –ê–Ω—Ç–æ–Ω–æ–≤–∏—á", ngo: "–ù–∞—Ä–æ–¥–Ω–∏–π –∞–Ω—Ç–∏–∫–æ—Ä—É–ø—Ü—ñ–π–Ω–∏–π –Ω–∞–≥–ª—è–¥", pdf: "public/candidates/–ö—É—Ç–Ω–∏–π.pdf" },
      "16": { name: "–†–æ–∑—É–º –û–ª–µ–≥ –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á", ngo: "–ù–∞—Ä–æ–¥–Ω–∏–π –∞–Ω—Ç–∏–∫–æ—Ä—É–ø—Ü—ñ–π–Ω–∏–π –Ω–∞–≥–ª—è–¥", pdf: "public/candidates/–†–æ–∑—É–º.pdf" },
      "17": { name: "–õ–µ–≤—á–µ–Ω–∫–æ –í‚Äô—è—á–µ—Å–ª–∞–≤ –í–∞—Å–∏–ª—å–æ–≤–∏—á", ngo: "–ù–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π –∞–Ω—Ç–∏–∫–æ—Ä—É–ø—Ü—ñ–π–Ω–∏–π —Ü–µ–Ω—Ç—Ä –£–∫—Ä–∞—ó–Ω–∏", pdf: "public/candidates/–õ–µ–≤—á–µ–Ω–∫–æ.pdf" },
      "18": { name: "–†–∏–±–∞–ª–∫–æ –¢–µ—Ç—è–Ω–∞ –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", ngo: "–ù–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π –∞–Ω—Ç–∏–∫–æ—Ä—É–ø—Ü—ñ–π–Ω–∏–π —Ü–µ–Ω—Ç—Ä –£–∫—Ä–∞—ó–Ω–∏", pdf: "public/candidates/–†–∏–±–∞–ª–∫–æ.pdf" },
      "19": { name: "–ü–ª–æ—Å–∫–∞ –ì–∞–Ω–Ω–∞ –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞", ngo: "–ù–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π —Ü–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–∑–∞—Ö–∏—Å—Ç—É", pdf: "public/candidates/–ü–ª–æ—Å–∫–∞.pdf" },
      "20": { name: "–ü—à–µ–Ω–∏—á–Ω–∏–π –î–∞–≤–∏–¥ –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á", ngo: "–ù–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π —Ü–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–∑–∞—Ö–∏—Å—Ç—É", pdf: "public/candidates/–ü—à–µ–Ω–∏—á–Ω–∏–π.pdf" },
      "21": { name: "–Ø—Ü–∏–Ω—è–∫ –Ñ–ª–∏–∑–∞–≤–µ—Ç–∞ –¢–∞—Ä–∞—Å—ñ–≤–Ω–∞", ngo: "–ù–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π —Ü–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–∑–∞—Ö–∏—Å—Ç—É", pdf: "public/candidates/–Ø—Ü–∏–Ω—è–∫.pdf" },
      "22": { name: "–ö–æ—Å—Ç–µ—Ü—å–∫–∏–π –ú–∞–∫—Å–∏–º –Æ—Ä—ñ–π–æ–≤–∏—á", ngo: "–ù–µ–∑–∞–ª–µ–∂–Ω–∞ –∞–Ω—Ç–∏–∫–æ—Ä—É–ø—Ü—ñ–π–Ω–∞ –∫–æ–º—ñ—Å—ñ—è", pdf: "public/candidates/–ö–æ—Å—Ç–µ—Ü—å–∫–∏–π.pdf" },
      "23": { name: "–ù—ñ–∫–æ–ª–∞—î–Ω–∫–æ –¢–µ—Ç—è–Ω–∞ –í–æ–ª–æ–¥–∏–º–∏—Ä—ñ–≤–Ω–∞", ngo: "–ù–µ–∑–∞–ª–µ–∂–Ω–∞ –∞–Ω—Ç–∏–∫–æ—Ä—É–ø—Ü—ñ–π–Ω–∞ –∫–æ–º—ñ—Å—ñ—è", pdf: "public/candidates/–ù—ñ–∫–æ–ª–∞—î–Ω–∫–æ.pdf" },
      "24": { name: "–¢—Ä–µ–≥—É–± –û–ª–µ–Ω–∞ –ú–∏–∫–æ–ª–∞—ó–≤–Ω–∞", ngo: "–ù–µ–∑–∞–ª–µ–∂–Ω–∞ –∞–Ω—Ç–∏–∫–æ—Ä—É–ø—Ü—ñ–π–Ω–∞ –∫–æ–º—ñ—Å—ñ—è", pdf: "public/candidates/–¢—Ä–µ–≥—É–±.pdf" },
      "25": { name: "–ö–æ—Ä–æ–ª—å–æ–≤ –Ü–≥–æ—Ä –°–µ—Ä–≥—ñ–π–æ–≤–∏—á", ngo: "–†–∞–∑–æ–º –ø—Ä–æ—Ç–∏ –∫–æ—Ä—É–ø—Ü—ñ—ó", pdf: "public/candidates/–ö–æ—Ä–æ–ª—å–æ–≤.pdf" },
      "26": { name: "–†—è–±–µ–∫–∞ –Ñ–≤–≥–µ–Ω—ñ—è –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", ngo: "–†–∞–∑–æ–º –ø—Ä–æ—Ç–∏ –∫–æ—Ä—É–ø—Ü—ñ—ó", pdf: "public/candidates/–†—è–±–µ–∫–∞.pdf" },
      "27": { name: "–°–ª–µ—Å–∞—Ä–µ–Ω–∫–æ –Ñ–≤–≥–µ–Ω—ñ–π –Ü–≥–æ—Ä–æ–≤–∏—á", ngo: "–†–∞–∑–æ–º –ø—Ä–æ—Ç–∏ –∫–æ—Ä—É–ø—Ü—ñ—ó", pdf: "public/candidates/–°–ª–µ—Å–∞—Ä–µ–Ω–∫–æ.pdf" },
      "28": { name: "–û—Å—ñ–Ω—á—É–∫ –û—Å—Ç–∞–ø –ú–∏—Ä–æ—Å–ª–∞–≤–æ–≤–∏—á", ngo: "–°–ø—ñ–ª–∫–∞ –æ—Ñ—ñ—Ü–µ—Ä—ñ–≤ –£–∫—Ä–∞—ó–Ω–∏", pdf: "public/candidates/–û—Å—ñ–Ω—á—É–∫.pdf" },
      "29": { name: "–ú—ñ—Ç—î–≤–∞ –ö–∞—Ç–µ—Ä–∏–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", ngo: "–°—Ç–µ–π—Ç–≤–æ—Ç—á", pdf: "public/candidates/–ú—ñ—Ç—î–≤–∞.pdf" },
      "30": { name: "–ü–æ–ø–æ–≤–∏—á –Ü–Ω–Ω–∞ –Æ—Ä—ñ—ó–≤–Ω–∞", ngo: "–°—Ç–µ–π—Ç–≤–æ—Ç—á", pdf: "public/candidates/–ü–æ–ø–æ–≤–∏—á.pdf" },
      "31": { name: "–ë—ñ—â—É–∫ –í—ñ–∫—Ç–æ—Ä –ü–∞–≤–ª–æ–≤–∏—á", ngo: "–£–∫—Ä–∞—ó–Ω—Å—å–∫–µ –ø—Ä–∞–≤–Ω–∏—á–µ —Ç–æ–≤–∞—Ä–∏—Å—Ç–≤–æ", pdf: "public/candidates/–ë—ñ—â—É–∫.pdf" },
      "32": { name: "–ú–∞—Å—é–∫ –í—ñ—Ç–∞–ª—ñ–π –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á", ngo: "–£–∫—Ä–∞—ó–Ω—Å—å–∫–µ –ø—Ä–∞–≤–Ω–∏—á–µ —Ç–æ–≤–∞—Ä–∏—Å—Ç–≤–æ", pdf: "public/candidates/–ú–∞—Å—é–∫.pdf" },
      "33": { name: "–ß–µ—Ä–Ω–æ–≤ –û–ª–µ–≥ –í–∞–ª–µ—Ä—ñ–π–æ–≤–∏—á", ngo: "–£–∫—Ä–∞—ó–Ω—Å—å–∫–µ –ø—Ä–∞–≤–Ω–∏—á–µ —Ç–æ–≤–∞—Ä–∏—Å—Ç–≤–æ", pdf: "public/candidates/–ß–µ—Ä–Ω–æ–≤.pdf" },
      "34": { name: "–ö–∞–ª–∏–Ω—á—É–∫ –ê–Ω–Ω–∞ –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", ngo: "–§—É–Ω–¥–∞—Ü—ñ—è –î–ï–Æ–†–ï", pdf: "public/candidates/–ö–∞–ª–∏–Ω—á—É–∫.pdf" },
      "35": { name: "–ì–µ—Ä–∞—â–µ–Ω–∫–æ –û–ª–µ–∫—Å–∞–Ω–¥—Ä –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á", ngo: "–¶–µ–Ω—Ç—Ä –ø—Ä–æ—Ç–∏–¥—ñ—ó —Ä–µ–π–¥–µ—Ä—Å—Ç–≤—É —Ç–∞ –∫–æ—Ä—É–ø—Ü—ñ—ó", pdf: "public/candidates/–ì–µ—Ä–∞—â–µ–Ω–∫–æ.pdf" },
      "36": { name: "–ö—Ä–∏–≤–æ—à–µ—è –ì–µ–Ω–Ω–∞–¥—ñ–π –ì—Ä–∏–≥–æ—Ä–æ–≤–∏—á", ngo: "–¶–µ–Ω—Ç—Ä –ø—Ä–æ—Ç–∏–¥—ñ—ó —Ä–µ–π–¥–µ—Ä—Å—Ç–≤—É —Ç–∞ –∫–æ—Ä—É–ø—Ü—ñ—ó", pdf: "public/candidates/–ö—Ä–∏–≤–æ—à–µ—è.pdf" },
      "37": { name: "–Ø—Ä–æ–≤–∞ –ë–æ–≥–¥–∞–Ω–∞ –ï–¥—É–∞—Ä–¥—ñ–≤–Ω–∞", ngo: "–¶–µ–Ω—Ç—Ä –ø—Ä–æ—Ç–∏–¥—ñ—ó —Ä–µ–π–¥–µ—Ä—Å—Ç–≤—É —Ç–∞ –∫–æ—Ä—É–ø—Ü—ñ—ó", pdf: "public/candidates/–Ø—Ä–æ–≤–∞.pdf" },
      "38": { name: "–î–∞—Ü–µ–Ω–∫–æ –ö–∞—Ç–µ—Ä–∏–Ω–∞ –ê–Ω–¥—Ä—ñ—ó–≤–Ω–∞", ngo: "–¶–µ–Ω—Ç—Ä —Å—É—Å–ø—ñ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—é", pdf: "public/candidates/–î–∞—Ü–µ–Ω–∫–æ.pdf" },
      "39": { name: "–ú–∏–∫–∏—Ç—é–∫ –ê–Ω—Ç–æ–Ω –°–µ—Ä–≥—ñ–π–æ–≤–∏—á", ngo: "–¶–µ–Ω—Ç—Ä —Å—É—Å–ø—ñ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—é", pdf: "public/candidates/–ú–∏–∫–∏—Ç—é–∫.pdf" },
      "40": { name: "–ü—Ä—É–¥–∫–æ–≤—Å—å–∫–∏—Ö –í—ñ–∫—Ç–æ—Ä –í‚Äô—è—á–µ—Å–ª–∞–≤–æ–≤–∏—á", ngo: "–¶–µ–Ω—Ç—Ä —Å—É—Å–ø—ñ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—é", pdf: "public/candidates/–ü—Ä—É–¥–∫–æ–≤—Å—å–∫–∏—Ö.pdf" }
    };
    Object.keys(CANDIDATES_LIST).forEach(id => {
      CANDIDATES_LIST[id].id = parseInt(id, 10);
    });

    // –î–∞–Ω—ñ –ø—Ä–æ –≥—Ä—É–ø–∏ (–¥–ª—è —Ç–µ–≥—ñ–≤)
    const tagsMap = {
      "–î–µ–º–°–æ–∫–∏—Ä–∞ —Ç–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–∏": [1, 2, 3, 5, 7, 8, 22, 23, 24, 31, 32, 33, 38, 39, 40],
      "–ö–æ–∞–ª—ñ—Ü—ñ—è –Ø—Ä–æ–≤–æ—ó": [37, 36, 35, 27, 26, 25, 17, 18, 10, 11],
      "–°—Ç–∞–ª–∫–µ—Ä—è—Ç–∞": [14, 19, 13, 21, 20]
    };

    // ---------------------------------------------------------
    // –ó–º—ñ–Ω–Ω—ñ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∏–Ω–∞–º—ñ—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö
    // ---------------------------------------------------------
    let candidatesData = [];
    let voteHistory = {};
    let top15Ids = [];
    let currentSortKey = 'votes';
    let currentTagFilter = "";

    // ---------------------------------------------------------
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤–∏–ø–∞–¥–∞—é—á–æ–≥–æ —Å–ø–∏—Å–∫—É —Ç–µ–≥—ñ–≤
    // ---------------------------------------------------------
    function populateTagFilter() {
      const tagFilter = document.getElementById('tagFilter');
      const allTags = Object.keys(tagsMap);

      let optionsHtml = `<option value="">–í—Å—ñ –≥—Ä—É–ø–∏</option>`;
      optionsHtml += allTags
        .map(tag => `<option value="${tag}">${tag}</option>`)
        .join('');
      tagFilter.innerHTML = optionsHtml;
    }

    // ---------------------------------------------------------
    // –û—Å–Ω–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –ø–∞—Ä—Å–∏–Ω–≥—É –ø—Ä–æ—Ç–æ–∫–æ–ª—É
    // ---------------------------------------------------------
    async function fetchAndParseProtocol() {
      try {
        const res = await fetch(PROTOCOL_URL);
        if (!res.ok) {
          throw new Error(`HTTP error! status: ${res.status}`);
        }
        const text = await res.text();

        // –û—á–∏—â–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –¥–∞–Ω—ñ
        candidatesData = [];

        // –†–æ–∑–±–∏–≤–∞—î–º–æ –ø–æ —Ä—è–¥–∫–∞—Ö
        const lines = text.trim().split('\n');
        
        // –ü—Ä–∏–ø—É—Å—Ç–∏–º–æ, —Ñ–æ—Ä–º–∞—Ç:
        // "<—Ä—è–¥–∫–æ–≤–∏–π_–Ω–æ–º–µ—Ä> <ID_–∫–∞–Ω–¥–∏–¥–∞—Ç–∞> <–≥–æ–ª–æ—Å–∏>"
        lines.forEach(line => {
          const lineParts = line.trim().split(/\s+/);
          if (lineParts.length >= 3) {
            const candidateId = lineParts[1];
            const votes = lineParts[2];
            if (!isNaN(candidateId) && !isNaN(votes)) {
              const idNum = parseInt(candidateId, 10);
              const votesNum = parseInt(votes, 10);
              
              const meta = CANDIDATES_LIST[candidateId] || {
                name: "–ù–µ–≤—ñ–¥–æ–º–∏–π –∫–∞–Ω–¥–∏–¥–∞—Ç #" + candidateId,
                ngo: "",
                pdf: ""
              };

              candidatesData.push({
                id: idNum,
                name: meta.name,
                ngo: meta.ngo,
                pdf: meta.pdf,
                votes: votesNum
              });
            }
          }
        });

        // –°–æ—Ä—Ç—É—î–º–æ –ø–æ –≥–æ–ª–æ—Å–∞—Ö, –≤–∏–∑–Ω–∞—á–∞—î–º–æ —Ç–æ–ø-15
        candidatesData.sort((a, b) => b.votes - a.votes);
        top15Ids = candidatesData.slice(0, 15).map(c => c.id);

        // –û–Ω–æ–≤–∏–º–æ —ñ—Å—Ç–æ—Ä—ñ—é
        const timestamp = Date.now();
        updateHistory(timestamp);

        // –ú–∞–ª—é—î–º–æ —Ç–∞–±–ª–∏—Ü—é
        renderTable();

        // –û–Ω–æ–≤–∏–º–æ —á–∞—Å
        const updateInfo = document.getElementById('updateInfo');
        updateInfo.textContent = `–û–Ω–æ–≤–ª–µ–Ω–æ: ${new Date(timestamp).toLocaleString('uk-UA')}`;
      } catch (err) {
        console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è protocol.txt", err);
      }
    }

    // ---------------------------------------------------------
    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó (voteHistory)
    // ---------------------------------------------------------
    function updateHistory(timestamp) {
      candidatesData.forEach(candidate => {
        if (!voteHistory[candidate.id]) {
          voteHistory[candidate.id] = [];
        }
        voteHistory[candidate.id].push({
          timestamp: timestamp,
          votes: candidate.votes
        });
      });
    }

    // ---------------------------------------------------------
    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è (—Ä–µ–Ω–¥–µ—Ä) —Ç–∞–±–ª–∏—Ü—ñ –∫–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤
    // ---------------------------------------------------------
    function renderTable() {
      const table = document.getElementById('candidateTable');
      const searchInput = document.getElementById('searchInput').value.trim().toLowerCase();

      // –§—ñ–ª—å—Ç—Ä—É–≤–∞–Ω–Ω—è
      let filteredCandidates = candidatesData.filter(candidate => {
        // 1) –§—ñ–ª—å—Ç—Ä –ø–æ —Ç–µ–≥—É
        if (currentTagFilter) {
          const candidateTag = getTag(candidate.id);
          if (candidateTag !== currentTagFilter) return false;
        }
        // 2) –ü–æ—à—É–∫
        if (searchInput) {
          const matchName = candidate.name.toLowerCase().includes(searchInput);
          return matchName;
        }
        return true;
      });

      // –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
      filteredCandidates.sort((a, b) => {
        if (currentSortKey === 'votes') {
          return b.votes - a.votes;
        } else if (currentSortKey === 'id') {
          return a.id - b.id;
        }
        return 0;
      });

      // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –º–∞–∫—Å–∏–º—É–º –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä—É
      const maxVotes = candidatesData.length
        ? Math.max(...candidatesData.map(c => c.votes))
        : 1;

      const rowsHtml = filteredCandidates.map(candidate => {
        const percent = candidate.votes ? (candidate.votes / maxVotes) * 100 : 0;
        const candidateTag = getTag(candidate.id);
        const tagClass =
          candidateTag === "–î–µ–º–°–æ–∫–∏—Ä–∞ —Ç–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–∏"
            ? "dem-sokyra"
            : candidateTag === "–ö–æ–∞–ª—ñ—Ü—ñ—è –Ø—Ä–æ–≤–æ—ó"
            ? "yarova"
            : candidateTag === "–°—Ç–∞–ª–∫–µ—Ä—è—Ç–∞"
            ? "stalkeryata"
            : "";
        const isTop15 = top15Ids.includes(candidate.id) ? 'passed' : '';

        return `
          <tr class="hover:bg-gray-50 ${isTop15}">
            <td class="p-4 text-gray-700 font-semibold">${candidate.id}</td>
            <td class="p-4 text-gray-800 font-medium">
              ${candidate.name}
              ${
                candidateTag
                  ? `<span class="tag ${tagClass}">${candidateTag}</span>`
                  : ''
              }
            </td>
            <td class="p-4 text-gray-600">${candidate.ngo}</td>
            <td class="p-4 text-gray-900 text-right font-bold">
              <div class="progress-container">
                <div class="progress-bar" style="width: ${percent}%;"></div>
                <span class="progress-label">
                  ${candidate.votes.toLocaleString('uk-UA')}
                </span>
              </div>
            </td>
            <td class="p-4 text-right">
              ${
                candidate.pdf
                  ? `<a href="${candidate.pdf}" target="_blank" class="pdf-link">PDF</a>`
                  : `‚Äî`
              }
            </td>
            <td class="p-4 text-right">
              <span class="history-icon" onclick="showHistoryPopup(${candidate.id})">üìú</span>
            </td>
          </tr>
        `;
      }).join('');

      table.innerHTML = rowsHtml;
    }

    // ---------------------------------------------------------
    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–æ–ø–∞–ø—É –∑ —ñ—Å—Ç–æ—Ä—ñ—î—é –≥–æ–ª–æ—Å—É–≤–∞–Ω—å
    // ---------------------------------------------------------
    function showHistoryPopup(candidateId) {
      const candidateHistory = voteHistory[candidateId] || [];
      const historyPopup = document.getElementById('historyPopup');
      const historyList = document.getElementById('historyList');

      const sortedHistory = [...candidateHistory].sort((a, b) => b.timestamp - a.timestamp);

      historyList.innerHTML = sortedHistory
        .map(entry => {
          return `<li>${new Date(entry.timestamp).toLocaleString('uk-UA')}: ${entry.votes} –≥–æ–ª–æ—Å—ñ–≤</li>`;
        })
        .join('');

      historyPopup.style.display = 'block';
    }

    document.getElementById('closePopup').addEventListener('click', () => {
      document.getElementById('historyPopup').style.display = 'none';
    });

    // ---------------------------------------------------------
    // –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
    // ---------------------------------------------------------
    function getTag(candidateId) {
      for (const [tagName, idsArr] of Object.entries(tagsMap)) {
        if (idsArr.includes(candidateId)) {
          return tagName;
        }
      }
      return null;
    }

    // ---------------------------------------------------------
    // –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π
    // ---------------------------------------------------------
    document.getElementById('searchInput').addEventListener('input', renderTable);
    document.getElementById('tagFilter').addEventListener('change', (e) => {
      currentTagFilter = e.target.value;
      renderTable();
    });
    document.getElementById('sortByVotes').addEventListener('click', () => {
      currentSortKey = 'votes';
      renderTable();
    });
    document.getElementById('sortById').addEventListener('click', () => {
      currentSortKey = 'id';
      renderTable();
    });

    // ---------------------------------------------------------
    // –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–∏
    // ---------------------------------------------------------
    populateTagFilter();
    fetchAndParseProtocol();
    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 10 —Ö–≤–∏–ª–∏–Ω (–∑–∞ –±–∞–∂–∞–Ω–Ω—è, –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä–≤–∞–ª)
    setInterval(fetchAndParseProtocol, 600000);
  </script>
</body>
</html>
